<link rel="import" href="import.html">
<link rel="import" href="chat-list.html">
<dom-module id="rola-chat">
	<style is="rola-chat">
		:host{height: 100%;}
		#item-icon{width: 23%;height: 52px;margin-right: 6%;border-radius: 100%;}
    	paper-item{margin:2% 0;}
    	paper-drawer-panel {
		  --paper-drawer-panel-main-container: {
		    background-color: pink;
		  };
		}
		#chat_list p {
		  margin: 0;
		}
		#chat_list .chat_img {
		  display: inline-block;
		  height: auto;
		  text-align: center;
		  width: 13%;
		}
		#chat_list img {
		  border: 1px solid black;
		  border-radius: 100%;
		  padding: 8px;
		  width: 30%;
		}
		.chat_img .username {
		  display: block;
		}
		#chat_list .chat_text {
		  border: 1px solid black;
		  border-radius: 10px;
		  display: inline-block;
		  height: auto;
		  margin-top: 1%;
		  padding: 1% 2%;
		  vertical-align: top;
		}
		.its_n_me{text-align: right;padding-right: 2%;}
	</style>
	<template>
		<core-pubnub publish_key="pub-c-94d1a035-2627-4841-b08c-00780f692a03" subscribe_key="sub-c-33eb06bc-40d3-11e5-81f8-02ee2ddab7fe" uuid="som">
		  	<core-pubnub-publish id="pub" channel="Channel-7fofnbj5o" message$="{{message}}"></core-pubnub-publish>
			<core-pubnub-subscribe id="sub" channel="Channel-7fofnbj5o" message$="{{message}}" on-callback="subscribeCallback"> 
			</core-pubnub-subscribe>
		</core-pubnub>
		<paper-drawer-panel>
		  	<div drawer>
		  		<paper-toolbar class="tall">
					<div class="title bottom indent">Rola Chat</div>
				</paper-toolbar>
			</div>
		  	<div main>
		  		<paper-toolbar> 
		  		 	<div class="layout horizontal flex">
				    	<span class="flex">Rola Chat</span>
				    	<span>2</span> 
				    	<iron-icon icon="account-circle"></paper-icon>
			    	</div>
				</paper-toolbar>

				<template is="dom-repeat" items="{{showData}}">
					<div class$="{{add_class(item.uuid,item.color)}}">
						<div id="chat_list">
								<div class="chat_img">
									<img src$="{{item.avatar}}" title$="{{item.username}}"/>
									<span class="username">{{item.uuid}}</span>
								</div>
								<div class="chat_text">
									<span class="text">{{item.text}}</span>
								</div>
						</div>
					</div>
				</template>

		  	 	<div class="bottom send-message layout horizontal flex">
	  	 			<paper-input label="Type message..." class="flex" id="input_paper" value="{{input_paper_value::input}}"></paper-input>
				  	<paper-fab icon="send" on-click="sendMessage"></paper-fab>
				</div>
		  	</div>
		</paper-drawer-panel>
	</template>	
</dom-module>
<script type="text/javascript">
Polymer({
	is:"Rola-chat",
	properties:{
		message:{
			type:Array,
			value:[]
		},
		showData:{
			type:Array,
			value:[],
			notify:true,
			reflectToAttribute: true
		}
	},
	ready:function(){
		this.uuid = "som";
		this.color = "red";
		this.avatarUrl = "../gravatar/1439672458_ktip.png";
		this.message=[];
	},
	add_class:function(x,y){
		if(this.uuid == x)
			return y+" its_me";
		else
			return y+" its_n_me";
	},
	sendMessage:function(){
		var input_data = document.querySelector('#input_paper');
		if(!input_data.value) return;
		this.message = [{
		    uuid: this.uuid, 
		    avatar: this.avatarUrl,
		    color: this.color, 
		    text: input_data.value  
		}];
		this.$.pub.publish();
		input_data.value="";
	},
	subscribeCallback:function(data,susu){
		if(susu.length>=1)
			this.push("showData",susu[0]);
	}
});
</script>


